---
title: Exchange OnlineMicrosoft 365 中的資料恢復功能
description: 在本文中，將說明 Exchange Online 和 Microsoft 365 內資料恢復的各個方面。
ms.author: robmazz
author: robmazz
manager: laurawi
ms.reviewer: sosstah
audience: ITPro
ms.topic: article
ms.service: O365-seccomp
localization_priority: Normal
search.appverid:
- MET150
ms.collection:
- Strat_O365_IP
- M365-security-compliance
- MS-Compliance
f1.keywords:
- NOCSH
ms.custom: seo-marvel-apr2020
titleSuffix: Microsoft Service Assurance
hideEdit: true
ms.openlocfilehash: 8952d492c4427d5f4af64a853adaaf15303e8caf
ms.sourcegitcommit: fb379d1110a9a86c7f9bab8c484dc3f4b3dfd6f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 06/23/2021
ms.locfileid: "53088632"
---
# <a name="exchange-online-data-resiliency-in-microsoft-365"></a><span data-ttu-id="caae7-103">Exchange Online Microsoft 365 中的資料恢復功能</span><span class="sxs-lookup"><span data-stu-id="caae7-103">Exchange Online data resiliency in Microsoft 365</span></span>

>[!IMPORTANT]
><span data-ttu-id="caae7-104">當我們繼續以保留信箱內容的不同方式投資時，我們宣佈 Exchange 系統管理中心的退休 In-Place 保留 (EAC) 中 Exchange Online。</span><span class="sxs-lookup"><span data-stu-id="caae7-104">As we continue to invest in different ways to preserve mailbox content, we're announcing the retirement of In-Place Holds in the Exchange admin center (EAC) in Exchange Online.</span></span> <span data-ttu-id="caae7-105">從2020年7月1日開始，您將無法建立新的 In-Place 保留。</span><span class="sxs-lookup"><span data-stu-id="caae7-105">Starting July 1, 2020, you won't be able to create new In-Place Holds.</span></span> <span data-ttu-id="caae7-106">不過，您仍然可以管理 EAC 中的 In-Place，或是使用 Exchange Online PowerShell 中的 **Set-MailboxSearch** Cmdlet 來管理。</span><span class="sxs-lookup"><span data-stu-id="caae7-106">But you'll still be able to manage In-Place Holds in the EAC or by using the **Set-MailboxSearch** cmdlet in Exchange Online PowerShell.</span></span> <span data-ttu-id="caae7-107">不過，從2020年10月1日開始，您將無法管理 In-Place 保留。</span><span class="sxs-lookup"><span data-stu-id="caae7-107">However, starting October 1, 2020, you won't be able to manage In-Place Holds.</span></span> <span data-ttu-id="caae7-108">您只能在 EAC 或使用 **Remove-MailboxSearch** Cmdlet 中移除它們。</span><span class="sxs-lookup"><span data-stu-id="caae7-108">You'll only be able to remove them in the EAC or by using the **Remove-MailboxSearch** cmdlet.</span></span> <span data-ttu-id="caae7-109">仍支援使用 Exchange Server 和 Exchange 混合式部署的 In-Place 保留。</span><span class="sxs-lookup"><span data-stu-id="caae7-109">Using In-Place Holds in Exchange Server and Exchange hybrid deployments will still be supported.</span></span> <span data-ttu-id="caae7-110">如需 Exchange Online 中封存 In-Place 封存的詳細資訊，請參閱[舊版 eDiscovery tools 的退休](/microsoft-365/compliance/legacy-ediscovery-retirement)。</span><span class="sxs-lookup"><span data-stu-id="caae7-110">For more information about the retirement of In-Place Holds in Exchange Online, see [Retirement of legacy eDiscovery tools](/microsoft-365/compliance/legacy-ediscovery-retirement).</span></span>

<span data-ttu-id="caae7-111">原有範圍暫止 會保留所有的信箱內容，包括刪除的項目和修改項目的原始版本。</span><span class="sxs-lookup"><span data-stu-id="caae7-111">An In-Place Hold preserves all mailbox content, including deleted items and original versions of modified items.</span></span> <span data-ttu-id="caae7-112">[就地 eDiscovery](/exchange/security-and-compliance/in-place-ediscovery/in-place-ediscovery)搜尋時會傳回這類信箱項目。</span><span class="sxs-lookup"><span data-stu-id="caae7-112">All such mailbox items are returned in an [In-Place eDiscovery](/exchange/security-and-compliance/in-place-ediscovery/in-place-ediscovery) search.</span></span> <span data-ttu-id="caae7-113">當您設定使用者信箱的 In-Place 時，對應的封存信箱中的內容 (若啟用) 也會保留，並在 eDiscovery 搜尋中傳回。</span><span class="sxs-lookup"><span data-stu-id="caae7-113">When you place an In-Place Hold on a user's mailbox, the contents in the corresponding archive mailbox (if it's enabled) are also placed on hold and returned in an eDiscovery search.</span></span>

<span data-ttu-id="caae7-114">有兩種類型的損毀可能會影響 Exchange 資料庫：實體損毀，通常是由硬體 (所造成，也就是因其他因素而發生的儲存硬體) 問題和邏輯損毀。</span><span class="sxs-lookup"><span data-stu-id="caae7-114">There are two types of corruption that can affect an Exchange database: physical corruption, which is typically caused by hardware (in particular, storage hardware) problems, and logical corruption, which occurs due to other factors.</span></span> <span data-ttu-id="caae7-115">一般來說，在 Exchange 資料庫內可能會發生兩種類型的邏輯損毀：</span><span class="sxs-lookup"><span data-stu-id="caae7-115">Generally, there are two types of logical corruption that can occur within an Exchange database:</span></span>

- <span data-ttu-id="caae7-116">**資料庫邏輯損毀** -資料庫頁面校驗和相符，但是頁面上的資料在邏輯上有錯誤。</span><span class="sxs-lookup"><span data-stu-id="caae7-116">**Database logical corruption** - The database page checksum matches, but the data on the page is wrong logically.</span></span> <span data-ttu-id="caae7-117">當資料庫引擎 (可擴展的儲存體引擎 (ESE) ) 嘗試寫入資料庫頁面，但即使作業系統會傳回成功訊息時，資料永遠不會寫入磁片或寫入錯誤的位置，就會發生這種情況。</span><span class="sxs-lookup"><span data-stu-id="caae7-117">This can occur when the database engine (the Extensible Storage Engine (ESE)) attempts to write a database page and even though the operating system returns a success message, the data is either never written to the disk or it's written to the wrong place.</span></span> <span data-ttu-id="caae7-118">這稱為 *遺失的清除*。</span><span class="sxs-lookup"><span data-stu-id="caae7-118">This is referred to as a *lost flush*.</span></span> <span data-ttu-id="caae7-119">ESE 包含許多功能和保護措施，其設計目的是為了避免資料庫的實體損毀及其他資料遺失案例。</span><span class="sxs-lookup"><span data-stu-id="caae7-119">ESE includes numerous features and safeguards that are designed to prevent physical corruption of a database and other data loss scenarios.</span></span> <span data-ttu-id="caae7-120">為了避免遺失的刷新遺失資料，ESE 會在資料庫中包含遺失的清除偵測機制，以及 (單一分頁還原的功能) 修正此機制。</span><span class="sxs-lookup"><span data-stu-id="caae7-120">To prevent lost flushes from losing data, ESE includes a lost flush detection mechanism in the database along with a feature (single page restore) to correct it.</span></span>
- <span data-ttu-id="caae7-121">**儲存邏輯損毀** -資料會以使用者未預期的方式新增、刪除或操控。</span><span class="sxs-lookup"><span data-stu-id="caae7-121">**Store logical corruption** - Data is added, deleted, or manipulated in a way that the user doesn't expect.</span></span> <span data-ttu-id="caae7-122">這兩種情況是由協力廠商應用程式所造成。</span><span class="sxs-lookup"><span data-stu-id="caae7-122">These cases are caused by third-party applications.</span></span> <span data-ttu-id="caae7-123">使用者將它視為損毀，通常會損毀。</span><span class="sxs-lookup"><span data-stu-id="caae7-123">It's usually corruption in the sense that the user views it as corruption.</span></span> <span data-ttu-id="caae7-124">Exchange 存放區會將產生邏輯損毀的交易視為一系列有效的 MAPI 作業。</span><span class="sxs-lookup"><span data-stu-id="caae7-124">The Exchange store considers the transaction that produced the logical corruption to be a series of valid MAPI operations.</span></span> <span data-ttu-id="caae7-125">Exchange Online 中的[In-Place 保留](/exchange/security-and-compliance/create-or-remove-in-place-holds)功能提供對儲存邏輯損毀 (的保護，因為它可防止使用者或應用程式) 永久刪除內容。</span><span class="sxs-lookup"><span data-stu-id="caae7-125">The [In-Place Hold](/exchange/security-and-compliance/create-or-remove-in-place-holds) features in Exchange Online provides protection from store logical corruption (because it prevents content from being permanently deleted by a user or an application).</span></span> 

<span data-ttu-id="caae7-126">Exchange Online 會在記錄檔檢查和記錄檔重新顯示期間，對複寫的記錄檔執行數種一致性檢查。</span><span class="sxs-lookup"><span data-stu-id="caae7-126">Exchange Online performs several consistency checks on replicated log files during both log inspection and log replay.</span></span> <span data-ttu-id="caae7-127">這些一致性檢查會防止系統複製實體損毀。</span><span class="sxs-lookup"><span data-stu-id="caae7-127">These consistency checks prevent physical corruption from being replicated by the system.</span></span> <span data-ttu-id="caae7-128">例如，在記錄檢查期間，會有實體完整性檢查可驗證記錄檔，並驗證記錄檔中記錄的檢查碼是否符合記憶體中產生的 checksum。</span><span class="sxs-lookup"><span data-stu-id="caae7-128">For example, during log inspection, there is a physical integrity check that verifies the log file and validates that the checksum recorded in the log file matches the checksum generated in memory.</span></span> <span data-ttu-id="caae7-129">此外，會檢查記錄檔標頭，確定記錄檔中記錄的記錄檔簽名與記錄檔的記錄檔相符。</span><span class="sxs-lookup"><span data-stu-id="caae7-129">In addition, the log file header is examined to make sure the log file signature recorded in the log header matches that of the log file.</span></span> <span data-ttu-id="caae7-130">在記錄檔重播期間，記錄檔會進一步進行審查。</span><span class="sxs-lookup"><span data-stu-id="caae7-130">During log replay, the log file undergoes further scrutiny.</span></span> <span data-ttu-id="caae7-131">例如，資料庫標頭也包含與記錄檔的簽名進行比較的記錄簽章，以確保它們相符。</span><span class="sxs-lookup"><span data-stu-id="caae7-131">For example, the database header also contains the log signature that is compared with the log file's signature to ensure they match.</span></span> 

<span data-ttu-id="caae7-132">針對 Exchange Online 中的信箱資料損毀，可透過使用 Exchange 原生資料保護，利用跨多部伺服器和多個資料中心的應用層級複寫來進行保護的修復原則，以及協助防止資料因損毀或其他原因而遺失的其他功能。</span><span class="sxs-lookup"><span data-stu-id="caae7-132">Protection against corruption of mailbox data in Exchange Online is achieved by using Exchange Native Data Protection, a resiliency strategy that leverages application-level replication across multiple servers and multiple datacenters along with other features that help protect data from being lost due to corruption or other reasons.</span></span> <span data-ttu-id="caae7-133">這些功能包括由 Microsoft 或 Exchange Online 應用程式本身所管理的原生功能，例如：</span><span class="sxs-lookup"><span data-stu-id="caae7-133">These features include native features that are managed by Microsoft or the Exchange Online application itself, such as:</span></span>

- [<span data-ttu-id="caae7-134">資料可用性群組</span><span class="sxs-lookup"><span data-stu-id="caae7-134">Data Availability Groups</span></span>](/exchange/back-up-email)
- <span data-ttu-id="caae7-135">單一位修正</span><span class="sxs-lookup"><span data-stu-id="caae7-135">Single Bit Correction</span></span> 
- <span data-ttu-id="caae7-136">線上資料庫掃描</span><span class="sxs-lookup"><span data-stu-id="caae7-136">Online Database Scanning</span></span> 
- <span data-ttu-id="caae7-137">遺失的刷新偵測</span><span class="sxs-lookup"><span data-stu-id="caae7-137">Lost Flush Detection</span></span> 
- <span data-ttu-id="caae7-138">單一分頁還原</span><span class="sxs-lookup"><span data-stu-id="caae7-138">Single Page Restore</span></span> 
- <span data-ttu-id="caae7-139">信箱複寫服務</span><span class="sxs-lookup"><span data-stu-id="caae7-139">Mailbox Replication Service</span></span> 
- <span data-ttu-id="caae7-140">記錄檔檢查</span><span class="sxs-lookup"><span data-stu-id="caae7-140">Log File Checks</span></span> 
- <span data-ttu-id="caae7-141">在彈性檔案系統上部署</span><span class="sxs-lookup"><span data-stu-id="caae7-141">Deployment on Resilient File System</span></span> 

<span data-ttu-id="caae7-142">如需先前所列的原生功能的詳細資訊，請選取超連結，並查看下列相關資訊，以及有關沒有超連結之專案的詳細資訊。</span><span class="sxs-lookup"><span data-stu-id="caae7-142">For more information on the native features listed previously, select the hyperlinks, and see the following for additional information and for details on items without hyperlinks.</span></span> <span data-ttu-id="caae7-143">除了這些原生功能之外，Exchange Online 也包含客戶可管理的資料恢復功能，例如：</span><span class="sxs-lookup"><span data-stu-id="caae7-143">In addition to these native features, Exchange Online also includes data resiliency features that customers can manage, such as:</span></span> 
- [<span data-ttu-id="caae7-144">預設會啟用單一專案復原 () </span><span class="sxs-lookup"><span data-stu-id="caae7-144">Single Item Recovery (enabled by default)</span></span>](/exchange/recipients-in-exchange-online/manage-user-mailboxes/recover-deleted-messages) 
- [<span data-ttu-id="caae7-145">就地保留與訴訟資料暫留</span><span class="sxs-lookup"><span data-stu-id="caae7-145">In-Place Hold and Litigation Hold</span></span>](/exchange/security-and-compliance/in-place-and-litigation-holds) 
- [<span data-ttu-id="caae7-146">已刪除的郵件保留和 Soft-Deleted 信箱 (預設為啟用) </span><span class="sxs-lookup"><span data-stu-id="caae7-146">Deleted Item Retention and Soft-Deleted Mailboxes (both enabled by default)</span></span>](/exchange/recipients-in-exchange-online/delete-or-restore-mailboxes) 

## <a name="database-availability-groups"></a><span data-ttu-id="caae7-147">資料庫可用性群組</span><span class="sxs-lookup"><span data-stu-id="caae7-147">Database Availability Groups</span></span> 
<span data-ttu-id="caae7-148">Microsoft 365 中的每個信箱資料庫都裝載于[資料庫可用性群組中 (DAG) ](/exchange/back-up-email)並且複寫到相同地區內位於不同地理位置的資料中心。</span><span class="sxs-lookup"><span data-stu-id="caae7-148">Every mailbox database in Microsoft 365 is hosted in a [database availability group (DAG)](/exchange/back-up-email) and replicated to geographically separate datacenters within the same region.</span></span> <span data-ttu-id="caae7-149">最常見的設定是四個資料中心內的四個資料庫副本;不過，有些地區所用的資料中心， (資料庫會複寫至三個資料中心，而在澳大利亞和日本) 有兩個資料中心。</span><span class="sxs-lookup"><span data-stu-id="caae7-149">The most common configuration is four database copies in four datacenters; however, some regions have fewer datacenters (databases are replicated to three datacenters in India, and two datacenters in Australia and Japan).</span></span> <span data-ttu-id="caae7-150">但在所有的情況下，每個信箱資料庫都有四個副本分散在多個資料中心，因此可確保信箱資料受到軟體、硬體甚至資料中心失敗的保護。</span><span class="sxs-lookup"><span data-stu-id="caae7-150">But in all cases, every mailbox database has four copies that are distributed across multiple datacenters, thereby ensuring that mailbox data is protected from software, hardware, and even datacenter failures.</span></span> 

<span data-ttu-id="caae7-151">這四個副本中，有三個是設定為高可用性。</span><span class="sxs-lookup"><span data-stu-id="caae7-151">Out of these four copies, three of them are configured as highly available.</span></span> <span data-ttu-id="caae7-152">第四個副本已設定為 [延遲資料庫副本](/Exchange/high-availability/manage-ha/activate-lagged-db-copies)。</span><span class="sxs-lookup"><span data-stu-id="caae7-152">The fourth copy is configured as a [lagged database copy](/Exchange/high-availability/manage-ha/activate-lagged-db-copies).</span></span> <span data-ttu-id="caae7-153">延遲資料庫副本不適用於個別的信箱復原或訊息項目復原。</span><span class="sxs-lookup"><span data-stu-id="caae7-153">The lagged database copy is not intended for individual mailbox recovery or mailbox item recovery.</span></span> <span data-ttu-id="caae7-154">其目的是為了提供復原機制，以進行極少的系統嚴重損壞邏輯損毀的事件。</span><span class="sxs-lookup"><span data-stu-id="caae7-154">Its purpose is to provide a recovery mechanism for the rare event of system-wide, catastrophic logical corruption.</span></span> 

<span data-ttu-id="caae7-155">延遲中的資料庫副本是以七天的記錄檔重新顯示延遲時間設定 Exchange Online。</span><span class="sxs-lookup"><span data-stu-id="caae7-155">Lagged database copies in Exchange Online are configured with a seven-day log file replay lag time.</span></span> <span data-ttu-id="caae7-156">此外，也會啟用 Exchange 重新顯示 Lag 管理員，以提供延遲副本的動態記錄檔，以允許延遲資料庫副本自行修復並記錄管理檔成長。</span><span class="sxs-lookup"><span data-stu-id="caae7-156">In addition, the Exchange Replay Lag Manager is enabled to provide dynamic log file play down for lagged copies to allow lagged database copies to self-repair and manage log file growth.</span></span> <span data-ttu-id="caae7-157">雖然延遲資料庫副本是用於 Exchange Online，但是請務必瞭解它們不是一個有保證的時間點備份。</span><span class="sxs-lookup"><span data-stu-id="caae7-157">Although lagged database copies are used in Exchange Online, it is important to understand that they are not a guaranteed point-in-time backup.</span></span> <span data-ttu-id="caae7-158">延遲 Exchange Online 中的資料庫副本具有可用性閾值（通常是90%），因為磁片上有延遲副本因磁片故障而遺失的情況，延遲副本會變成高可用性的副本 (，因為這是因為自動向下) ，也就是延遲資料庫副本重新產生記錄檔重放佇列的期限。</span><span class="sxs-lookup"><span data-stu-id="caae7-158">Lagged database copies in Exchange Online have an availability threshold, typically around 90%, due to periods where the disk containing a lagged copy is lost due to disk failure, the lagged copy becoming a highly available copy (due to automatic play down), as well as the periods where the lagged database copy is rebuilding the log replay queue.</span></span> 

## <a name="transport-resilience"></a><span data-ttu-id="caae7-159">傳輸恢復</span><span class="sxs-lookup"><span data-stu-id="caae7-159">Transport Resilience</span></span> 
<span data-ttu-id="caae7-160">Exchange Online 包括兩個主要的傳輸恢復功能：卷影冗余及安全性 Net。</span><span class="sxs-lookup"><span data-stu-id="caae7-160">Exchange Online includes two primary transport resilience features: Shadow Redundancy and Safety Net.</span></span> <span data-ttu-id="caae7-161">「陰影冗余」會在傳輸期間保留郵件的重複副本。</span><span class="sxs-lookup"><span data-stu-id="caae7-161">Shadow Redundancy keeps a redundant copy of a message while it is in transit.</span></span> <span data-ttu-id="caae7-162">[安全性] Net 會在成功傳遞郵件後，保留郵件的重複副本。</span><span class="sxs-lookup"><span data-stu-id="caae7-162">Safety Net keeps a redundant copy of a message after the message is successfully delivered.</span></span> 

<span data-ttu-id="caae7-163">有了陰影冗余，每個 Exchange Online 傳輸伺服器都會在它認可成功接收郵件至傳送伺服器的每一封郵件上進行複本。</span><span class="sxs-lookup"><span data-stu-id="caae7-163">With Shadow Redundancy, each Exchange Online transport server makes a copy of each message it receives before it acknowledges successfully receiving the message to the sending server.</span></span> <span data-ttu-id="caae7-164">這會使傳輸管線中的所有郵件在傳輸期間都是多餘的。</span><span class="sxs-lookup"><span data-stu-id="caae7-164">This makes all messages in the transport pipeline redundant while in transit.</span></span> <span data-ttu-id="caae7-165">如果 Exchange Online 判斷原始郵件在傳輸過程中遺失，將會重新傳遞郵件的重複副本。</span><span class="sxs-lookup"><span data-stu-id="caae7-165">If Exchange Online determines the original message was lost in transit, a redundant copy of the message is redelivered.</span></span> 

<span data-ttu-id="caae7-166">安全網路是與信箱伺服器上的傳輸服務相關聯的傳輸佇列。</span><span class="sxs-lookup"><span data-stu-id="caae7-166">Safety Net is a transport queue that is associated with the Transport service on a Mailbox server.</span></span> <span data-ttu-id="caae7-167">此佇列儲存伺服器已成功處理的郵件副本。</span><span class="sxs-lookup"><span data-stu-id="caae7-167">This queue stores copies of messages that were successfully processed by the server.</span></span> <span data-ttu-id="caae7-168">當信箱資料庫或伺服器失敗需要啟用信箱資料庫的過期複本時，系統會自動將安全網路佇列中的郵件重新提交至信箱資料庫的新主動副本。</span><span class="sxs-lookup"><span data-stu-id="caae7-168">When a mailbox database or server failure requires activating an out-of-date copy of the mailbox database, messages in the Safety Net queue are automatically resubmitted to the new active copy of the mailbox database.</span></span> <span data-ttu-id="caae7-169">Net Net 也是多餘的，因此可避免傳輸成為單一失敗點。</span><span class="sxs-lookup"><span data-stu-id="caae7-169">Safety Net is also redundant, thereby eliminating transport as a single point of failure.</span></span> <span data-ttu-id="caae7-170">它使用主要安全網和陰影安全網路的概念，其中如果主要的安全網在超過12小時內不可用，則重新提交要求會變成陰影重新提交要求，而且會從陰影的安全網路重新傳遞郵件。</span><span class="sxs-lookup"><span data-stu-id="caae7-170">It uses the concept of a Primary Safety Net and a Shadow Safety Net wherein if the Primary Safety Net is unavailable for more than 12 hours, resubmit requests become shadow resubmit requests, and messages are redelivered from the Shadow Safety Net.</span></span>

<span data-ttu-id="caae7-171">由管理 DAGs 和信箱資料庫副本之 Microsoft Exchange 複寫服務的 Active Manager 元件自動啟動來自安全網的郵件 safety。</span><span class="sxs-lookup"><span data-stu-id="caae7-171">Message resubmissions from Safety Net are automatically initiated by the Active Manager component of the Microsoft Exchange Replication service that manages DAGs and mailbox database copies.</span></span> <span data-ttu-id="caae7-172">不需要手動動作便可重新提交來自安全網路的郵件。</span><span class="sxs-lookup"><span data-stu-id="caae7-172">No manual actions are required to resubmit messages from Safety Net.</span></span> 

## <a name="single-bit-correction"></a><span data-ttu-id="caae7-173">單一位修正</span><span class="sxs-lookup"><span data-stu-id="caae7-173">Single Bit Correction</span></span> 
<span data-ttu-id="caae7-174">ESE 包含一種機制，可偵測和解決單一位 CRC 錯誤 (也稱為單一位翻轉) ，這是硬體錯誤的結果 (，所以它們代表實體損毀) 。</span><span class="sxs-lookup"><span data-stu-id="caae7-174">ESE includes a mechanism to detect and resolve single-bit CRC errors (also known as single-bit flips) that are the result of hardware errors (and as such they represent physical corruption).</span></span> <span data-ttu-id="caae7-175">當發生這些錯誤時，ESE 會自動修正這些錯誤，並記錄事件記錄檔中的事件。</span><span class="sxs-lookup"><span data-stu-id="caae7-175">When these errors occur, ESE automatically corrects them and logs an event in the event log.</span></span> 

## <a name="online-database-scanning"></a><span data-ttu-id="caae7-176">線上資料庫掃描</span><span class="sxs-lookup"><span data-stu-id="caae7-176">Online Database Scanning</span></span> 
<span data-ttu-id="caae7-177">線上資料庫掃描 (也稱為 *資料庫檢查求和*) 是 ESE 使用資料庫一致性檢查程式來讀取每個頁面及檢查分頁損毀的處理常式。</span><span class="sxs-lookup"><span data-stu-id="caae7-177">Online database scanning (also known as *database check summing*) is the process where an ESE uses a database consistency checker to read each page and check for page corruption.</span></span> <span data-ttu-id="caae7-178">主要用途是偵測可能無法透過事務性作業偵測到的實際損毀和遺失的刷新。</span><span class="sxs-lookup"><span data-stu-id="caae7-178">The primary purpose is to detect physical corruption and lost flushes that may not be getting detected by transactional operations.</span></span> <span data-ttu-id="caae7-179">資料庫掃描也會執行儲存後的損毀作業。</span><span class="sxs-lookup"><span data-stu-id="caae7-179">Database scanning also performs post-store crash operations.</span></span> <span data-ttu-id="caae7-180">磁碟空間可能會因損毀而洩漏，而且線上資料庫掃描會找到並恢復遺失的空間。</span><span class="sxs-lookup"><span data-stu-id="caae7-180">Space can be leaked due to crashes, and online database scanning finds and recovers lost space.</span></span> <span data-ttu-id="caae7-181">系統所設計的預期是每7天完全掃描一次每個資料庫。</span><span class="sxs-lookup"><span data-stu-id="caae7-181">The system is designed with the expectation that every database is fully scanned once every seven days.</span></span> 

## <a name="lost-flush-detection"></a><span data-ttu-id="caae7-182">遺失的刷新偵測</span><span class="sxs-lookup"><span data-stu-id="caae7-182">Lost Flush Detection</span></span> 
<span data-ttu-id="caae7-183">當磁片子系統/作業系統傳回完成的資料庫寫入作業實際上未寫入磁片，或是寫入錯誤的位置時，就會發生遺失清除。</span><span class="sxs-lookup"><span data-stu-id="caae7-183">A lost flush occurs when a database write operation that the disk subsystem/operating system returned as completed did not actually get written to disk, or was written in the wrong location.</span></span> <span data-ttu-id="caae7-184">遺失的刷新事件可能會導致資料庫邏輯損毀，因此，避免遺失的刷新導致資料遺失，ESE 會包含遺失的清除偵測機制。</span><span class="sxs-lookup"><span data-stu-id="caae7-184">Lost flush incidents can result in database logical corruption, so to prevent lost flushes from resulting in lost data, ESE includes a lost flush detection mechanism.</span></span> <span data-ttu-id="caae7-185">當資料庫頁面寫入被動副本時，會對使用中副本上的遺失的刷新執行檢查。</span><span class="sxs-lookup"><span data-stu-id="caae7-185">As database pages are written to passive copies, a check is performed for lost flushes on the active copy.</span></span> <span data-ttu-id="caae7-186">如果偵測到遺失的清除，ESE 便可使用頁面修補程式修復處理常式。</span><span class="sxs-lookup"><span data-stu-id="caae7-186">If a lost flush is detected, ESE can repair the process using a page patching process.</span></span> 

## <a name="single-page-restore"></a><span data-ttu-id="caae7-187">單一分頁還原</span><span class="sxs-lookup"><span data-stu-id="caae7-187">Single Page Restore</span></span> 
<span data-ttu-id="caae7-188">單一分頁還原（也稱為 *頁面修補*）是一種自動處理方式，在狀況良好的副本中，完好的副本會取代損壞的資料庫頁面。</span><span class="sxs-lookup"><span data-stu-id="caae7-188">Single page restore, also known as *page patching*, is an automatic process where corrupt database pages are replaced by healthy copies from a healthy replica.</span></span> <span data-ttu-id="caae7-189">損壞頁面的修復程式取決於資料庫副本為主動或被動。</span><span class="sxs-lookup"><span data-stu-id="caae7-189">The repair process for a corrupt page depends on whether the database copy is active or passive.</span></span> <span data-ttu-id="caae7-190">當作用中的資料庫副本遇到損毀的頁面時，它可以從其複本中複製頁面（只要它所複製的頁面是最新的）。</span><span class="sxs-lookup"><span data-stu-id="caae7-190">When an active database copy encounters a corrupted page, it can copy a page from one of its replicas, provided the page it copies is up to date.</span></span> <span data-ttu-id="caae7-191">您可以將頁面要求放入記錄檔（即信箱資料庫複寫的基礎），以完成此程式。</span><span class="sxs-lookup"><span data-stu-id="caae7-191">This process is accomplished by putting a request for the page into the log stream, which is the basis of mailbox database replication.</span></span> <span data-ttu-id="caae7-192">當複本到達頁面要求時，它會傳送頁面的副本到要求的資料庫副本，以進行回應。</span><span class="sxs-lookup"><span data-stu-id="caae7-192">As soon as a replica encounters the page request, it responds by sending a copy of the page to the requesting database copy.</span></span> <span data-ttu-id="caae7-193">單一分頁還原也提供非同步通訊機制，可讓作用中從複本要求頁面，即使複本目前已離線也是一樣。</span><span class="sxs-lookup"><span data-stu-id="caae7-193">Single page restore also provides an asynchronous communication mechanism for the active to request a page from replicas, even if the replicas are currently offline.</span></span> 

<span data-ttu-id="caae7-194">在被動資料庫副本（包括延遲資料庫副本）遭到損毀時，因為這些複本永遠落後于主動副本，所以將任何頁面從主動副本複製到被動複本時，總會是安全的。</span><span class="sxs-lookup"><span data-stu-id="caae7-194">In case of corruption in a passive database copy, including a lagged database copy, because these copies are always behind their active copy, it is always safe to copy any page from the active copy to a passive copy.</span></span> <span data-ttu-id="caae7-195">被動資料庫副本的自然可用性非常高，所以在修補頁面時，記錄檔重新顯示已暫停，但記錄複製會繼續進行。</span><span class="sxs-lookup"><span data-stu-id="caae7-195">A passive database copy is by nature highly available, so during the page patching process, log replaying is suspended, but log copying continues.</span></span> <span data-ttu-id="caae7-196">被動資料庫副本會從主動副本中檢索損毀的頁面複本，直到複製並檢查符合最大要求記錄檔要求的記錄檔為止，然後再修補損壞的頁面。</span><span class="sxs-lookup"><span data-stu-id="caae7-196">The passive database copy retrieves a copy of the corrupted page from the active copy, waits until the log file that meets the maximum required log generation requirement is copied and inspected, and then patches the corrupt page.</span></span> <span data-ttu-id="caae7-197">在修補頁面後，記錄檔重新顯示簡歷。</span><span class="sxs-lookup"><span data-stu-id="caae7-197">Once the page has been patched, log replay resumes.</span></span> <span data-ttu-id="caae7-198">延遲資料庫副本的程式是相同的，唯一不同之處在于，延遲資料庫會先重新顯示取得能狀態所需的所有記錄檔。</span><span class="sxs-lookup"><span data-stu-id="caae7-198">The process is the same for the lagged database copy, except that the lagged database first replays all log files that are necessary to achieve a patchable state.</span></span> 

## <a name="mailbox-replication-service"></a><span data-ttu-id="caae7-199">信箱複寫服務</span><span class="sxs-lookup"><span data-stu-id="caae7-199">Mailbox Replication Service</span></span> 
<span data-ttu-id="caae7-200">移動信箱是管理大規模電子郵件服務的重要部分。</span><span class="sxs-lookup"><span data-stu-id="caae7-200">Moving mailboxes is a key part of managing a large-scale email service.</span></span> <span data-ttu-id="caae7-201">時刻都有更新的技術與硬體和版本升級，使我們的工程師能夠完成這項工作，同時讓使用者能在) 整個程式中保持線上，使信箱對使用者 (保持線上狀態，並確保在信箱變得更大及更大的情況下，處理常式會適當地伸縮。</span><span class="sxs-lookup"><span data-stu-id="caae7-201">There are always updated technologies and hardware and version upgrades to deal with, so having a robust, throttled system that enables our engineers to accomplish this work while keeping the mailbox moves transparent to users (by making sure they stay online throughout the process) is key and making sure that the process scales up gracefully as mailboxes get larger and larger.</span></span> 

<span data-ttu-id="caae7-202">Exchange 的信箱複寫服務 (MRS) 負責在資料庫之間移動信箱。</span><span class="sxs-lookup"><span data-stu-id="caae7-202">The Exchange Mailbox Replication Service (MRS) is responsible for moving mailboxes between databases.</span></span> <span data-ttu-id="caae7-203">在移動期間，MRS 會對信箱內的所有專案執行一致性檢查。</span><span class="sxs-lookup"><span data-stu-id="caae7-203">During the move, MRS performs a consistency check on all items within the mailbox.</span></span> <span data-ttu-id="caae7-204">如果發現一致性問題，MRS 將修正問題，或略過損毀的專案，進而移除信箱的損毀。</span><span class="sxs-lookup"><span data-stu-id="caae7-204">If a consistency issue is found, MRS will either correct the problem, or skip the corrupted items, thereby removing the corruption from the mailbox.</span></span> 

<span data-ttu-id="caae7-205">因為 MRS 是 Exchange Online 的元件，所以我們可在其程式碼中進行變更，以解決未來所偵測到的新損毀形式。</span><span class="sxs-lookup"><span data-stu-id="caae7-205">Because MRS is a component of Exchange Online, we can make changes in its code to address new forms of corruption that are detected in the future.</span></span> <span data-ttu-id="caae7-206">例如，如果我們偵測到 MRS 無法修正的一致性問題，我們可以分析損毀、變更 MRS 程式碼，並修正不一致的 (如果我們瞭解如何) 。</span><span class="sxs-lookup"><span data-stu-id="caae7-206">For example, if we detect a consistency issue that MRS is not able to fix, we can analyze the corruption, change the MRS code and correct the inconsistency (if we understand how to).</span></span> 

## <a name="log-file-checks"></a><span data-ttu-id="caae7-207">記錄檔檢查</span><span class="sxs-lookup"><span data-stu-id="caae7-207">Log File Checks</span></span> 
<span data-ttu-id="caae7-208">Exchange 資料庫所產生的所有交易記錄檔都會經歷數種不同的一致性檢查格式。</span><span class="sxs-lookup"><span data-stu-id="caae7-208">All transaction log files generated by an Exchange database undergo several forms of consistency checks.</span></span> <span data-ttu-id="caae7-209">在建立記錄檔時，首先會寫入一個位模式，然後執行一系列的記錄寫入作業。</span><span class="sxs-lookup"><span data-stu-id="caae7-209">When a log file is created, the first thing done is a bit pattern is written and then a series of log writes is performed.</span></span> <span data-ttu-id="caae7-210">此結構可讓 Exchange Online 執行一系列的檢查 (遺失的清除、CRC 和其他檢查，) 在寫入每個記錄檔時進行驗證，以及在複製時重新驗證。</span><span class="sxs-lookup"><span data-stu-id="caae7-210">This structure enables Exchange Online to execute a series of checks (lost flush, CRC, and other checks) to validate each log file as it is written, and again as it is replicated.</span></span> 

## <a name="deployment-on-resilient-file-system"></a><span data-ttu-id="caae7-211">在彈性檔案系統上部署</span><span class="sxs-lookup"><span data-stu-id="caae7-211">Deployment on Resilient File System</span></span> 
<span data-ttu-id="caae7-212">若要防止檔案系統層級的損毀，Exchange Online 部署于彈性檔案系統上 (ReFS) 磁碟分割以提供增強的復原功能。</span><span class="sxs-lookup"><span data-stu-id="caae7-212">To help prevent corruption from occurring at the file system level, Exchange Online is being deployed on Resilient File System (ReFS) partitions to provide improved recovery capabilities.</span></span> <span data-ttu-id="caae7-213">ReFS 是 Windows Server 2012 和更新版本中的檔案系統，其設計使其能夠更具彈性，避免資料損毀，從而使資料的可用性和完整性達到最大。</span><span class="sxs-lookup"><span data-stu-id="caae7-213">ReFS is a file system in Windows Server 2012 and later that is designed to be more resilient against data corruption thereby maximizing data availability and integrity.</span></span> <span data-ttu-id="caae7-214">具體而言，ReFS 會以更新中繼資料的方式取得改進，以提供更好的資料保護，並減少資料損毀案例。</span><span class="sxs-lookup"><span data-stu-id="caae7-214">Specifically, ReFS brings improvements in the way that metadata is updated which offers better protection for data and reduces data corruption cases.</span></span> <span data-ttu-id="caae7-215">它也會使用校驗和來驗證檔案資料和中繼資料的完整性，以確保容易找到並修復資料損毀。</span><span class="sxs-lookup"><span data-stu-id="caae7-215">It also uses checksums to verify the integrity of file data and metadata ensuring that data corruption is easily found and repaired.</span></span> 

<span data-ttu-id="caae7-216">Exchange Online 會利用數個 ReFS 優點：</span><span class="sxs-lookup"><span data-stu-id="caae7-216">Exchange Online takes advantage of several ReFS benefits:</span></span> 
- <span data-ttu-id="caae7-217">資料完整性的彈性越多，意味著較少的資料損毀事件。</span><span class="sxs-lookup"><span data-stu-id="caae7-217">More resiliency in data integrity means fewer data corruption incidents.</span></span> <span data-ttu-id="caae7-218">減少損毀事件的數量，意味著較少不必要的資料庫重新植入。</span><span class="sxs-lookup"><span data-stu-id="caae7-218">Reducing the number of corruption incidents means fewer unnecessary database reseeds.</span></span> 
- <span data-ttu-id="caae7-219">在中繼資料上執行的檢查碼，可使偵測到破壞案例的速度更快且更明確，讓我們能夠修正客戶資料損毀，在資料量出現灰色失敗之前。</span><span class="sxs-lookup"><span data-stu-id="caae7-219">Checksum running on metadata enabling detections of corruption cases sooner and more deterministically, allowing us to fix customer data corruption before grey failures occur on data volumes.</span></span>
- <span data-ttu-id="caae7-220">可搭配大型資料集（pb 和更大）搭配效能，而不會影響效能</span><span class="sxs-lookup"><span data-stu-id="caae7-220">Designed to work well with large data sets—petabytes and larger—without performance impact</span></span>
- <span data-ttu-id="caae7-221">支援 Exchange Online 所使用的其他功能，例如 BitLocker 加密。</span><span class="sxs-lookup"><span data-stu-id="caae7-221">Support for other features used by Exchange Online, such as BitLocker encryption.</span></span> 

<span data-ttu-id="caae7-222">Exchange Online 也會受益于其他 ReFS 功能：</span><span class="sxs-lookup"><span data-stu-id="caae7-222">Exchange Online also benefits from other ReFS features:</span></span> 
- <span data-ttu-id="caae7-223">**完整性 (完整性資料流程)** ReFS 儲存資料的方式，可防止一般會導致資料遺失的常見錯誤。</span><span class="sxs-lookup"><span data-stu-id="caae7-223">**Integrity (Integrity Streams)** - ReFS stores data in a way that protects it from many of the common errors that can normally cause data loss.</span></span> <span data-ttu-id="caae7-224">Microsoft 365搜尋會使用完整性資料流程，協助早期磁片損毀偵測和檔案內容的校驗和。</span><span class="sxs-lookup"><span data-stu-id="caae7-224">Microsoft 365 Search uses Integrity Streams to help with early disk corruption detection and checksums of file content.</span></span> <span data-ttu-id="caae7-225">此功能也可減少因「斷寫」所造成的損毀事件， (當寫入作業由於電源中斷等問題而無法完成時，請 ) 。</span><span class="sxs-lookup"><span data-stu-id="caae7-225">The feature also reduces corruption incidents caused by 'Torn Writes” (when a write operation does not complete due to power outages, etc.).</span></span> 
- <span data-ttu-id="caae7-226">**可用性 (搶救)** ReFS 優先順序的資料可用性。</span><span class="sxs-lookup"><span data-stu-id="caae7-226">**Availability (Salvage)** - ReFS prioritizes the availability of data.</span></span> <span data-ttu-id="caae7-227">從過去的角度來看，檔案系統常常會受到資料損毀的破壞，需要系統離線才能進行修復。</span><span class="sxs-lookup"><span data-stu-id="caae7-227">Historically, file systems were often susceptible to data corruption that would require the system to be taken offline for repair.</span></span> <span data-ttu-id="caae7-228">雖然很少會發生損毀，但 ReFS 會執行搶救，這項功能會從即時磁片區上的命名空間中移除損毀的資料，並確保無法在非修復損毀的資料上受到不良的資料影響。</span><span class="sxs-lookup"><span data-stu-id="caae7-228">Although rare, if corruption does occur, ReFS implements salvage, a feature that removes the corrupt data from the namespace on a live volume and ensures that good data is not adversely affected by non-repairable corrupt data.</span></span> <span data-ttu-id="caae7-229">套用搶救功能並隔離資料損毀以 Exchange Online 資料庫磁片區，意味著我們可以將不受影響的資料庫置於損毀與修復動作之間的健康磁片。</span><span class="sxs-lookup"><span data-stu-id="caae7-229">Applying the Salvage feature and isolating data corruption to Exchange Online database volumes means that we can keep non-affected databases on a corrupted volume healthy between the time of corruption and repair action.</span></span> <span data-ttu-id="caae7-230">此結構可增加一般會受到這類磁片損毀問題影響的資料庫可用性。</span><span class="sxs-lookup"><span data-stu-id="caae7-230">This structure increases the availability of databases that would normally be affected by such disk corruption issues.</span></span> 
